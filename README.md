# Сервис назначения ревьюеров для Pull Request’ов
Выполнено в рамках тестового задания Avito (Backend, Autumn 2025)

## Быстрый старт

1. **Запуск сервиса:**
   Команда соберет приложение, поднимет PostgreSQL, применит миграции и запустит HTTP-сервер
   ```bash
   make docker-up
   ```

2. **Остановка сервиса:**
   Команда останавливает контейнеры и очищает данные БД
   ```bash
   make docker-down
   ```

## Доступ к API

После запуска доступны следующие эндпоинты:

- Swagger UI (визуальный интерфейс): [http://localhost:8080/swagger/index.html](http://localhost:8080/swagger/index.html)
- OpenAPI Spec (исходный файл): [http://localhost:8080/openapi.yaml](http://localhost:8080/openapi.yaml)

## Дополнительные задания

### 1. Эндпоинт статистики

Реализован эндпоинт для получения статистики по количеству назначений на ревью для каждого пользователя

- `GET /stats/assignments` - возвращает массив объектов со статистикой по каждому пользователю

### 2. Эндпоинт работоспособности
Реализован технический эндпоинт для проверки работоспособности сервиса, предназначенный для систем мониторинга

- `GET /healthz` - возвращает `{"status": "OK"}`, если сервис запущен и отвечает на запросы

### 3. Эндпоинт массовой деактивации

Реализован эндпоинт для массовой деактивации всех участников команды. Операция выполняется в рамках одной транзакции, чтобы гарантировать консистентность данных

- `POST /team/deactivate` - деактивирует всех активных пользователей в указанной команде, после этого эти пользователи удаляются из списка ревьюеров всех **открытых** PR (так как найти замену в полностью деактивированной команде невозможно). Возвращает список деактивированных пользователей и затронутых PR

Проведено тестирование производительности метода массовой деактивации

**Сценарий:**
- Команда: 100 пользователей
- Активные PR: 1000 штук

**Результаты:**
Среднее время выполнения: **~11.4 ms** (требование 100 ms)

**Запуск тестирования производительности:**
```bash
make bench
```

### 4. Интеграционное тестирование

Реализовано интеграционное тестирование для всех слоев приложения (`repository`, `service`, `handler`).

Используется библиотека **testcontainers-go** для поднятия экземпляра PostgreSQL в Docker для каждого пакета тестов

Все тесты написаны в соответствии с паттерном **Arrange-Act-Assert**, что обеспечивает их читаемость и поддерживаемость

Покрытие кода тестами составляет:
- Repository: **73.9%**
- Service: **82.4%**
- Handler: **63.6%**

1. **Запуск тестов:**
   Команда выполняет прогон всех тестов в проекте. При первом запуске автоматически скачает необходимый Docker-образ Postgres
   ```bash
   make test
   ```
2. **Запуск тестов с отчетом о покрытии:**
   Команда запускает тесты, рассчитывает процент покрытия кода для каждого пакета и  открывает HTML-отчет в браузере
   ```bash
   make test-cover
   ```

### 5. Линтер

Интегрирован статический анализатор **golangci-lint**

Конфигурация с набором правил находится в файле `.golangci.yml`

**Запуск анализатора:**
```bash
make lint
```

## Конфигурация

Настройки задаются через переменные окружения в `docker-compose.yml`:

| Описание | Значение по умолчанию |
| :--- | :--- |
| Порт HTTP сервера | `8080` |
| Подключение к PostgreSQL | `postgres://app:app@db:5432/app?sslmode=disable` |
